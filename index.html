<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pet Playland • Tamagotchi + Mini Games</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
    
</head>
<body>
    <div class="app">
        <div class="topbar">
            <div class="title">Pet Playland</div>
            <div class="chip">Liquid Glass UI</div>
        </div>

        <div class="tabs">
            <button class="tab active" data-tab="pet">Pet</button>
            <button class="tab" data-tab="games">Games</button>
        </div>

        <section class="glass-card" id="tab-pet">
            <div class="pet-area">
                <div class="pet-shell">
                    <div class="pet-bg"></div>
                    <div class="pet" id="pet">
                        <div>
                            <div class="eyes"><span class="eye"></span><span class="eye"></span></div>
                            <div class="mouth"></div>
                        </div>
                    </div>
                </div>
                <div class="stats">
                    <div class="stat">
                        <div class="stat-row"><span>Happiness</span><span id="happyVal">50</span></div>
                        <div class="bar"><i id="happyBar" style="--v:50%"></i></div>
                    </div>
                </div>
                <div class="actions">
                    <button class="btn primary" id="btnPlay">Play</button>
                </div>
            </div>
        </section>

        <section class="glass-card" id="tab-games" style="display:none">
            <div class="games">
                <div class="game-tile" style="grid-column: 1 / -1;">
                    <h4>Ping Pong (vs AI)</h4>
                    <p>Touch to move your paddle. Play against AI!</p>
                    <button class="btn primary" id="openPong">Play</button>
                </div>
            </div>
        </section>
    </div>

    <!-- Ping Pong Modal -->
    <div class="modal" id="pongModal">
        <div class="modal-backdrop"></div>
        <div class="modal-card">
            <div class="modal-bar">
                <button class="btn" data-close="#pongModal">Close</button>
                <div class="modal-title">Ping Pong • vs AI</div>
                <button class="btn" id="pongReset">Reset</button>
            </div>
            <div class="modal-content"><canvas id="pongCanvas"></canvas></div>
        </div>
    </div>

    <script>
        // Persistence helpers
        const storage = {
            get() { try { return JSON.parse(localStorage.getItem('petState')||'{}'); } catch { return {}; } },
            set(data) { localStorage.setItem('petState', JSON.stringify(data)); }
        };

        // Tabs
        const tabs = document.querySelectorAll('.tab');
        tabs.forEach(t => t.addEventListener('click', () => {
            tabs.forEach(x => x.classList.remove('active'));
            t.classList.add('active');
            const isPet = t.dataset.tab === 'pet';
            document.getElementById('tab-pet').style.display = isPet ? '' : 'none';
            document.getElementById('tab-games').style.display = isPet ? 'none' : '';
        }));
        const petState = Object.assign({ happy: 50, last: Date.now() }, storage.get());
        const el = {
            happyBar: document.getElementById('happyBar'), happyVal: document.getElementById('happyVal')
        };
        function clamp(n) { return Math.max(0, Math.min(100, n)); }
        function renderPet() {
            el.happyBar.style.setProperty('--v', petState.happy + '%'); el.happyVal.textContent = petState.happy;
        }
        function decay() {
            const now = Date.now();
            const dt = Math.max(0, Math.floor((now - petState.last) / 1000));
            if (dt > 0) {
                petState.happy  = clamp(petState.happy - 0.009 * dt);
                petState.last = now;
                storage.set(petState);
                renderPet();
            }
        }
        setInterval(decay, 1000);
        renderPet();
        function nudge(type, amount) { petState[type] = clamp(petState[type] + amount); renderPet(); storage.set(petState); }
        document.getElementById('btnPlay').addEventListener('click', () => { nudge('happy', +15); openModal('#pongModal'); });
        function openModal(sel) { document.querySelector(sel).classList.add('active'); resizeCanvases(); }
        function closeModal(sel) { document.querySelector(sel).classList.remove('active'); }
        document.querySelectorAll('[data-close]').forEach(b => b.addEventListener('click', () => closeModal(b.getAttribute('data-close'))));
        document.getElementById('openPong').addEventListener('click', () => openModal('#pongModal'));
        function fitCanvas(canvas) {
            const parent = canvas.parentElement; const r = parent.getBoundingClientRect();
            const dpr = Math.min(2, window.devicePixelRatio || 1);
            canvas.width = Math.floor(r.width * dpr); canvas.height = Math.floor(r.height * dpr);
            const ctx = canvas.getContext('2d'); ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
            return ctx;
        }
        function resizeCanvases() { if (pong.running) pong.resize(); }
        window.addEventListener('resize', resizeCanvases);
        const pong = (() => {
            const canvas = document.getElementById('pongCanvas');
            let ctx, W, H, raf;
            const state = { ball: { x: 0, y: 0, vx: 4, vy: 4, r: 8 }, p1: { x: 0 }, p2: { x: 0 }, score: [0,0] };
            const AI_SPEED = 0.01;
            const AI_PREDICTION = 1;
            
            function resetBall(dir = (Math.random() > 0.5 ? 1 : -1)) {
                state.ball.x = W/2; state.ball.y = H/2; state.ball.vx = (Math.random()*2+3) * (Math.random()>.5?1:-1); state.ball.vy = (Math.random()*2+3) * dir;
            }
            
            function updateAI() {
                if (state.ball.vy < 0) {
                    const timeToReach = (state.ball.y - 16 - 12) / Math.abs(state.ball.vy);
                    const predictedX = state.ball.x + state.ball.vx * timeToReach * AI_PREDICTION;
                    const targetX = Math.max(45, Math.min(W - 45, predictedX));
                    state.p2.x += (targetX - state.p2.x) * AI_SPEED;
                    state.p2.x = Math.max(45, Math.min(W - 45, state.p2.x));
                } else {
                    const centerX = W / 2;
                    state.p2.x += (centerX - state.p2.x) * AI_SPEED * 0.3;
                }
            }
            
            function draw() {
                ctx.clearRect(0,0,W,H);
                ctx.strokeStyle = '#ffffff33'; ctx.setLineDash([8,10]); ctx.beginPath(); ctx.moveTo(0,H/2); ctx.lineTo(W,H/2); ctx.stroke(); ctx.setLineDash([]);
                const w=90,h=12, o=16;
                ctx.fillStyle = '#e8ecff';
                ctx.fillRect(state.p1.x - w/2, H - o - h, w, h);
                ctx.fillStyle = '#c8d5ff';
                ctx.fillRect(state.p2.x - w/2, o, w, h);
                ctx.fillStyle = '#ffffff';
                ctx.beginPath(); ctx.arc(state.ball.x, state.ball.y, state.ball.r, 0, Math.PI*2); ctx.fill();
                ctx.fillStyle = '#ffffffcc'; ctx.font = '700 16px Poppins'; ctx.textAlign = 'center';
                ctx.fillText('AI: ' + state.score[1], W/2, H/2 - 20);
                ctx.fillText('You: ' + state.score[0], W/2, H/2 + 36);
            }
            
            function step() {
                const w=90,h=12, o=16;
                updateAI();
                state.ball.x += state.ball.vx; state.ball.y += state.ball.vy;
                if (state.ball.x < state.ball.r || state.ball.x > W - state.ball.r) state.ball.vx *= -1;
                if (state.ball.y - state.ball.r < o + h && Math.abs(state.ball.x - state.p2.x) < w/2) {
                    state.ball.vy = Math.abs(state.ball.vy);
                    state.ball.vx += (state.ball.x - state.p2.x) * 0.03;
                }
                if (state.ball.y + state.ball.r > H - o - h && Math.abs(state.ball.x - state.p1.x) < w/2) {
                    state.ball.vy = -Math.abs(state.ball.vy);
                    state.ball.vx += (state.ball.x - state.p1.x) * 0.03;
                }
                if (state.ball.y < -20) { state.score[0]++; nudge('happy', +2); resetBall(1); }
                if (state.ball.y > H + 20) { state.score[1]++; nudge('happy', +1); resetBall(-1); }
            }
            
            function loop() { draw(); step(); raf = requestAnimationFrame(loop); }
            
            function pointerHandlers() {
                function move(e) {
                    const rect = canvas.getBoundingClientRect();
                    const touches = e.touches ? Array.from(e.touches) : [e];
                    touches.forEach(t => {
                        const x = (t.clientX - rect.left);
                        const y = (t.clientY - rect.top);
                        if (y > rect.height/2) {
                            state.p1.x = Math.max(45, Math.min(W - 45, x));
                        }
                    });
                }
                ['touchstart','touchmove','mousemove'].forEach(ev => canvas.addEventListener(ev, move, {passive:false}));
            }
            
            return {
                running:false,
                resize(){ ctx = fitCanvas(canvas); const r = canvas.getBoundingClientRect(); W=r.width; H=r.height; state.p1.x=W/2; state.p2.x=W/2; },
                start(){ this.resize(); resetBall(); pointerHandlers(); if (!this.running){ this.running=true; loop(); } },
                stop(){ if (raf) cancelAnimationFrame(raf); this.running=false; },
                reset(){ state.score=[0,0]; resetBall(); }
            };
        })();
        document.getElementById('pongReset').addEventListener('click', () => pong.reset());
        document.getElementById('pongModal').addEventListener('transitionend', () => resizeCanvases());
        const obs = new MutationObserver(() => { document.getElementById('pongModal').classList.contains('active') ? pong.start() : pong.stop(); });
        obs.observe(document.getElementById('pongModal'), { attributes: true, attributeFilter: ['class'] });
    </script>
</body>
</html>

