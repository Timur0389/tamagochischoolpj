<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pet Playland • Tamagotchi + Mini Games</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
    
</head>
<body>
    <div class="app">
        <div class="topbar">
            <div class="title">Pet Playland</div>
        </div>

        <div class="tabs">
            <button class="tab active" data-tab="pet">Pet</button>
            <button class="tab" data-tab="games">Games</button>
        </div>

        <section class="glass-card" id="tab-pet">
            <div class="pet-area">
                <div class="pet-shell">
                    <div class="pet-bg"></div>
                    <div class="pet" id="pet">
                        <div>
                            <div class="eyes"><span class="eye"></span><span class="eye"></span></div>
                            <div class="mouth"></div>
                        </div>
                    </div>
                </div>
                <div class="stats">
                    <div class="stat">
                        <div class="stat-row"><span>Happiness</span><span id="happyVal">50</span></div>
                        <div class="bar"><i id="happyBar" style="--v:50%"></i></div>
                    </div>
                </div>
                <div class="actions">
                    <button class="btn primary" id="btnPlay">Play</button>
                </div>
            </div>
        </section>

        <section class="glass-card" id="tab-games" style="display:none">
            <div class="games">
                <div class="game-tile" style="grid-column: 1 / -1;">
                    <h4>Ping Pong (vs AI)</h4>
                    <p>Touch to move your paddle. Play against AI!</p>
                    <button class="btn primary" id="openPong">Play</button>
                </div>
                <div class="game-tile">
                    <h4>Tic‑Tac‑Toe (vs AI)</h4>
                    <p>Play as X on a 3×3 board. First to 3 wins!</p>
                    <button class="btn primary" id="openTTT">Play</button>
                </div>
                <div class="game-tile">
                    <h4>Word Chain</h4>
                    <p>Say a word starting with the last letter of mine.</p>
                    <button class="btn primary" id="openWord">Play</button>
                </div>
            </div>
        </section>
    </div>

    <!-- Ping Pong Modal -->
    <div class="modal" id="pongModal">
        <div class="modal-backdrop"></div>
        <div class="modal-card">
            <div class="modal-bar">
                <button class="btn" data-close="#pongModal">Close</button>
                <div class="modal-title">Ping Pong • vs AI</div>
                <button class="btn" id="pongReset">Reset</button>
            </div>
            <div class="modal-content"><canvas id="pongCanvas"></canvas></div>
        </div>
    </div>

    <!-- Tic-Tac-Toe Modal -->
    <div class="modal" id="tttModal">
        <div class="modal-backdrop"></div>
        <div class="modal-card">
            <div class="modal-bar">
                <button class="btn" data-close="#tttModal">Close</button>
                <div class="modal-title">Tic‑Tac‑Toe • vs AI</div>
                <button class="btn" id="tttReset">Reset</button>
            </div>
            <div class="modal-content">
                <div id="tttBoard" style="display:grid; grid-template-columns: repeat(3, 1fr); gap:8px; padding:10px; height:100%; align-content:center; justify-items:center;">
                    <button data-i="0" class="btn" style="width:100%; aspect-ratio:1/1; font-size:28px; font-weight:700;"> </button>
                    <button data-i="1" class="btn" style="width:100%; aspect-ratio:1/1; font-size:28px; font-weight:700;"> </button>
                    <button data-i="2" class="btn" style="width:100%; aspect-ratio:1/1; font-size:28px; font-weight:700;"> </button>
                    <button data-i="3" class="btn" style="width:100%; aspect-ratio:1/1; font-size:28px; font-weight:700;"> </button>
                    <button data-i="4" class="btn" style="width:100%; aspect-ratio:1/1; font-size:28px; font-weight:700;"> </button>
                    <button data-i="5" class="btn" style="width:100%; aspect-ratio:1/1; font-size:28px; font-weight:700;"> </button>
                    <button data-i="6" class="btn" style="width:100%; aspect-ratio:1/1; font-size:28px; font-weight:700;"> </button>
                    <button data-i="7" class="btn" style="width:100%; aspect-ratio:1/1; font-size:28px; font-weight:700;"> </button>
                    <button data-i="8" class="btn" style="width:100%; aspect-ratio:1/1; font-size:28px; font-weight:700;"> </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Word Chain Modal -->
    <div class="modal" id="wordModal">
        <div class="modal-backdrop"></div>
        <div class="modal-card">
            <div class="modal-bar">
                <button class="btn" data-close="#wordModal">Close</button>
                <div class="modal-title">Word Chain</div>
                <button class="btn" id="wordReset">Reset</button>
            </div>
            <div class="modal-content" style="display:grid; grid-template-rows: auto auto 1fr; gap:10px; padding:10px;">
                <div id="wordInfo" style="color:#eaf0ff; padding:8px 10px;">Start the chain with any word.</div>
                <div style="display:flex; gap:8px; padding:0 10px 10px 10px;">
                    <input id="wordInput" placeholder="your word" style="flex:1; border-radius:10px; border:1px solid #ffffff33; background:#0b0f20; color:#eaf0ff; padding:10px;" />
                    <button class="btn primary" id="wordSubmit">Send</button>
                </div>
                <div id="wordLog" style="overflow:auto; padding:0 10px 10px 10px; color:#eaf0ff;">
                </div>
            </div>
        </div>
    </div>

    <script>
        // Persistence helpers
        const storage = {
            get() { try { return JSON.parse(localStorage.getItem('petState')||'{}'); } catch { return {}; } },
            set(data) { localStorage.setItem('petState', JSON.stringify(data)); }
        };

        // Tabs
        const tabs = document.querySelectorAll('.tab');
        tabs.forEach(t => t.addEventListener('click', () => {
            tabs.forEach(x => x.classList.remove('active'));
            t.classList.add('active');
            const isPet = t.dataset.tab === 'pet';
            document.getElementById('tab-pet').style.display = isPet ? '' : 'none';
            document.getElementById('tab-games').style.display = isPet ? 'none' : '';
        }));
        const petState = Object.assign({ happy: 50, last: Date.now() }, storage.get());
        const el = {
            happyBar: document.getElementById('happyBar'), happyVal: document.getElementById('happyVal')
        };
        function clamp(n) { return Math.max(0, Math.min(100, n)); }
        function renderPet() {
            el.happyBar.style.setProperty('--v', petState.happy + '%'); el.happyVal.textContent = petState.happy;
        }
        function decay() {
            const now = Date.now();
            const dt = Math.max(0, Math.floor((now - petState.last) / 1000));
            if (dt > 0) {
                petState.happy  = clamp(petState.happy - 0.009 * dt);
                petState.last = now;
                storage.set(petState);
                renderPet();
            }
        }
        setInterval(decay, 1000);
        renderPet();
        function nudge(type, amount) { petState[type] = clamp(petState[type] + amount); renderPet(); storage.set(petState); }
        document.getElementById('btnPlay').addEventListener('click', () => { nudge('happy', +15); openModal('#pongModal'); });
        function openModal(sel) { document.querySelector(sel).classList.add('active'); resizeCanvases(); }
        function closeModal(sel) { document.querySelector(sel).classList.remove('active'); }
        document.querySelectorAll('[data-close]').forEach(b => b.addEventListener('click', () => closeModal(b.getAttribute('data-close'))));
        document.getElementById('openPong').addEventListener('click', () => openModal('#pongModal'));
        function fitCanvas(canvas) {
            const parent = canvas.parentElement; const r = parent.getBoundingClientRect();
            const dpr = Math.min(2, window.devicePixelRatio || 1);
            canvas.width = Math.floor(r.width * dpr); canvas.height = Math.floor(r.height * dpr);
            const ctx = canvas.getContext('2d'); ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
            return ctx;
        }
        function resizeCanvases() { if (pong.running) pong.resize(); }
        window.addEventListener('resize', resizeCanvases);
        const pong = (() => {
            const canvas = document.getElementById('pongCanvas');
            let ctx, W, H, raf;
            const state = { ball: { x: 0, y: 0, vx: 4, vy: 4, r: 8 }, p1: { x: 0 }, p2: { x: 0 }, score: [0,0] };
            const AI_SPEED = 0.01;
            const AI_PREDICTION = 1;
            
            function resetBall(dir = (Math.random() > 0.5 ? 1 : -1)) {
                state.ball.x = W/2; state.ball.y = H/2; state.ball.vx = (Math.random()*2+3) * (Math.random()>.5?1:-1); state.ball.vy = (Math.random()*2+3) * dir;
            }
            
            function updateAI() {
                if (state.ball.vy < 0) {
                    const timeToReach = (state.ball.y - 16 - 12) / Math.abs(state.ball.vy);
                    const predictedX = state.ball.x + state.ball.vx * timeToReach * AI_PREDICTION;
                    const targetX = Math.max(45, Math.min(W - 45, predictedX));
                    state.p2.x += (targetX - state.p2.x) * AI_SPEED;
                    state.p2.x = Math.max(45, Math.min(W - 45, state.p2.x));
                } else {
                    const centerX = W / 2;
                    state.p2.x += (centerX - state.p2.x) * AI_SPEED * 0.3;
                }
            }
            
            function draw() {
                ctx.clearRect(0,0,W,H);
                ctx.strokeStyle = '#ffffff33'; ctx.setLineDash([8,10]); ctx.beginPath(); ctx.moveTo(0,H/2); ctx.lineTo(W,H/2); ctx.stroke(); ctx.setLineDash([]);
                const w=90,h=12, o=16;
                ctx.fillStyle = '#e8ecff';
                ctx.fillRect(state.p1.x - w/2, H - o - h, w, h);
                ctx.fillStyle = '#c8d5ff';
                ctx.fillRect(state.p2.x - w/2, o, w, h);
                ctx.fillStyle = '#ffffff';
                ctx.beginPath(); ctx.arc(state.ball.x, state.ball.y, state.ball.r, 0, Math.PI*2); ctx.fill();
                ctx.fillStyle = '#ffffffcc'; ctx.font = '700 16px Poppins'; ctx.textAlign = 'center';
                ctx.fillText('AI: ' + state.score[1], W/2, H/2 - 20);
                ctx.fillText('You: ' + state.score[0], W/2, H/2 + 36);
            }
            
            function step() {
                const w=90,h=12, o=16;
                updateAI();
                state.ball.x += state.ball.vx; state.ball.y += state.ball.vy;
                if (state.ball.x < state.ball.r || state.ball.x > W - state.ball.r) state.ball.vx *= -1;
                if (state.ball.y - state.ball.r < o + h && Math.abs(state.ball.x - state.p2.x) < w/2) {
                    state.ball.vy = Math.abs(state.ball.vy);
                    state.ball.vx += (state.ball.x - state.p2.x) * 0.03;
                }
                if (state.ball.y + state.ball.r > H - o - h && Math.abs(state.ball.x - state.p1.x) < w/2) {
                    state.ball.vy = -Math.abs(state.ball.vy);
                    state.ball.vx += (state.ball.x - state.p1.x) * 0.03;
                }
                if (state.ball.y < -20) { state.score[0]++; nudge('happy', +2); resetBall(1); }
                if (state.ball.y > H + 20) { state.score[1]++; nudge('happy', +1); resetBall(-1); }
            }
            
            function loop() { draw(); step(); raf = requestAnimationFrame(loop); }
            
            function pointerHandlers() {
                function move(e) {
                    const rect = canvas.getBoundingClientRect();
                    const touches = e.touches ? Array.from(e.touches) : [e];
                    touches.forEach(t => {
                        const x = (t.clientX - rect.left);
                        const y = (t.clientY - rect.top);
                        if (y > rect.height/2) {
                            state.p1.x = Math.max(45, Math.min(W - 45, x));
                        }
                    });
                }
                ['touchstart','touchmove','mousemove'].forEach(ev => canvas.addEventListener(ev, move, {passive:false}));
            }
            
            return {
                running:false,
                resize(){ ctx = fitCanvas(canvas); const r = canvas.getBoundingClientRect(); W=r.width; H=r.height; state.p1.x=W/2; state.p2.x=W/2; },
                start(){ this.resize(); resetBall(); pointerHandlers(); if (!this.running){ this.running=true; loop(); } },
                stop(){ if (raf) cancelAnimationFrame(raf); this.running=false; },
                reset(){ state.score=[0,0]; resetBall(); }
            };
        })();
        document.getElementById('pongReset').addEventListener('click', () => pong.reset());
        document.getElementById('pongModal').addEventListener('transitionend', () => resizeCanvases());
        const obs = new MutationObserver(() => { document.getElementById('pongModal').classList.contains('active') ? pong.start() : pong.stop(); });
        obs.observe(document.getElementById('pongModal'), { attributes: true, attributeFilter: ['class'] });

        // Open other modals
        document.getElementById('openTTT').addEventListener('click', () => openModal('#tttModal'));
        document.getElementById('openWord').addEventListener('click', () => openModal('#wordModal'));

        // Tic-Tac-Toe
        const ttt = (() => {
            const boardEl = document.getElementById('tttBoard');
            const cells = Array.from(boardEl.querySelectorAll('button'));
            let board = Array(9).fill('');
            let gameOver = false;
            const lines = [ [0,1,2],[3,4,5],[6,7,8], [0,3,6],[1,4,7],[2,5,8], [0,4,8],[2,4,6] ];
            function winner(b){
                for (const [a,c,d] of lines){ if (b[a]&&b[a]===b[c]&&b[a]===b[d]) return b[a]; }
                return b.every(x=>x)? 'draw' : '';
            }
            function render(){ cells.forEach((c,i)=>{ c.textContent = board[i]||' '; c.disabled = !!board[i] || gameOver; }); }
            function reset(){ board = Array(9).fill(''); gameOver=false; render(); }
            function bestMove(){
                // Minimax for small board
                function score(b, player){
                    const w = winner(b);
                    if (w==='O') return 1; if (w==='X') return -1; if (w==='draw') return 0;
                    const next = player==='X' ? 'O' : 'X';
                    let best = player==='O' ? -Infinity : Infinity;
                    for (let i=0;i<9;i++) if (!b[i]){
                        b[i]=player; const s = score(b, next); b[i]='';
                        if (player==='O'){ if (s>best) best=s; } else { if (s<best) best=s; }
                    }
                    return best;
                }
                let move=-1, best=-Infinity;
                for (let i=0;i<9;i++) if (!board[i]){
                    board[i]='O'; const s = score(board, 'X'); board[i]='';
                    if (s>best){ best=s; move=i; }
                }
                return move;
            }
            cells.forEach(btn=>btn.addEventListener('click', ()=>{
                const i = +btn.getAttribute('data-i');
                if (gameOver || board[i]) return;
                board[i]='X';
                let w = winner(board); render();
                if (w){ gameOver=true; return; }
                const ai = bestMove();
                if (ai!==-1){ board[ai]='O'; }
                w = winner(board); render();
                if (w){ gameOver=true; }
            }));
            document.getElementById('tttReset').addEventListener('click', reset);
            return { reset };
        })();

        // Word Chain
        const wordChain = (() => {
            const log = document.getElementById('wordLog');
            const info = document.getElementById('wordInfo');
            const input = document.getElementById('wordInput');
            const submit = document.getElementById('wordSubmit');
            const words = new Set();
            let last = '';
            const dict = [
                'apple','eagle','earth','tiger','robot','table','engine','echo','ocean','night','tree','elephant','tea','ant','tunnel','lamp','paper','rose','egg','game','energy','yellow','wolf','fire','rain','nut','top','pen','nose','ear','river','road','door','rat','tap','pot','toy','yarn','nutmeg','grape','elm','mint','tide','ember'
            ];
            function logLine(text){ const p=document.createElement('div'); p.textContent=text; log.appendChild(p); log.scrollTop = log.scrollHeight; }
            function reset(){ words.clear(); last=''; log.textContent=''; info.textContent='Start the chain with any word.'; input.value=''; input.focus(); }
            function normalize(w){ return (w||'').toLowerCase().replace(/[^a-z]/g,''); }
            function aiReply(start){
                const options = dict.filter(w => w.startsWith(start) && !words.has(w));
                if (options.length===0){ logLine('AI: I give up! You win.'); return; }
                const pick = options[Math.floor(Math.random()*options.length)];
                words.add(pick); logLine('AI: ' + pick);
                last = pick[pick.length-1];
                info.textContent = 'Your turn — word starting with "' + last + '"';
            }
            function submitWord(){
                let w = normalize(input.value);
                if (!w) return;
                if (words.has(w)){ logLine('You repeated a word. Try different.'); input.value=''; return; }
                if (last && w[0] !== last){ logLine('Must start with ' + last.toUpperCase()); input.value=''; return; }
                words.add(w); logLine('You: ' + w);
                last = w[w.length-1];
                info.textContent = 'AI thinking…';
                input.value='';
                setTimeout(()=>aiReply(last), 300);
            }
            submit.addEventListener('click', submitWord);
            input.addEventListener('keydown', (e)=>{ if (e.key==='Enter') submitWord(); });
            document.getElementById('wordReset').addEventListener('click', reset);
            return { reset };
        })();
    </script>
</body>
</html>

